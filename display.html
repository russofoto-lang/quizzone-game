<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DISPLAY - Il Quizzone</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a1a2e; color: white; font-family: 'Segoe UI', sans-serif; }
        .big-text { font-size: 3rem; font-weight: bold; text-align: center; margin-top: 20px; }
        .question-box { background: #16213e; padding: 40px; border-radius: 20px; border: 4px solid #0f3460; margin: 20px; }
        .answer-box { font-size: 2rem; color: #e94560; margin-top: 20px; display: none; }
        .winner-buzzer { animation: pulse 1s infinite; color: #facc15; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen">

    <div id="waiting-screen" class="text-center">
        <h1 class="text-6xl font-bold mb-4">IL QUIZZONE</h1>
        <p class="text-2xl text-gray-400">In attesa della prossima domanda...</p>
        <div id="buzzer-status" class="mt-10 text-4xl hidden">
            ðŸš¨ HA PRENOTATO: <span id="buzzer-name" class="font-bold text-yellow-400"></span> ðŸš¨
        </div>
    </div>

    <div id="game-container" class="hidden w-full max-w-4xl text-center">
        <div class="question-box">
            <h2 id="cat-text" class="text-xl text-yellow-500 mb-4 uppercase tracking-widest">CATEGORIA</h2>
            <div id="domanda-text" class="text-4xl font-bold mb-8">Testo della domanda qui...</div>
            
            <div id="options-container" class="grid grid-cols-2 gap-4 text-2xl hidden">
                </div>

            <div id="soluzione-box" class="answer-box">
                RISPOSTA ESATTA: <br>
                <span id="soluzione-text" class="text-white"></span>
            </div>
        </div>
    </div>

    <div id="leaderboard" class="absolute top-5 right-5 bg-white/10 p-4 rounded-lg">
        <h3 class="font-bold border-b border-white/20 mb-2">TOP TEAMS</h3>
        <ul id="leaderboard-list" class="text-sm"></ul>
    </div>

    <script>
        const socket = io();

        // 1. Identificazione
        socket.on('connect', () => {
            console.log("Display connesso");
            socket.emit('display_connect');
        });

        // 2. Ricezione Nuova Domanda
        socket.on('nuova_domanda', (domanda) => {
            document.getElementById('waiting-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            document.getElementById('soluzione-box').style.display = 'none';
            document.getElementById('buzzer-status').classList.add('hidden');

            document.getElementById('cat-text').innerText = domanda.categoria || "QUIZ";
            document.getElementById('domanda-text').innerText = domanda.domanda;

            const optsContainer = document.getElementById('options-container');
            optsContainer.innerHTML = '';
            
            // Se ci sono opzioni (quiz classico) mostrale, altrimenti nascondi
            if(domanda.risposte && domanda.risposte.length > 0) {
                optsContainer.classList.remove('hidden');
                domanda.risposte.forEach((r, index) => {
                    const div = document.createElement('div');
                    div.className = "bg-blue-600 p-4 rounded-lg";
                    div.innerText = r;
                    optsContainer.appendChild(div);
                });
            } else {
                optsContainer.classList.add('hidden');
            }
        });

        // 3. Gestione Buzzer
        socket.on('buzzer_bloccato', (data) => {
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('waiting-screen').style.display = 'block';
            document.getElementById('buzzer-status').classList.remove('hidden');
            document.getElementById('buzzer-name').innerText = data.winner;
            document.getElementById('buzzer-name').className = "font-bold text-yellow-400 winner-buzzer";
        });

        // 4. Mostra Soluzione
        socket.on('mostra_soluzione', (soluzione) => {
            // Se siamo nella schermata domanda
            document.getElementById('game-container').style.display = 'block';
            document.getElementById('waiting-screen').style.display = 'none';
            
            const box = document.getElementById('soluzione-box');
            box.style.display = 'block';
            
            // Se la soluzione Ã¨ un indice (0,1,2,3) o testo
            // Qui assumiamo arrivi il testo o l'indice corretto
            document.getElementById('soluzione-text').innerText = soluzione;
        });

        // 5. Aggiorna Classifica
        socket.on('update_classifica', (teams) => {
            // Ordina per punteggio decrescente
            teams.sort((a,b) => b.score - a.score);
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            teams.slice(0, 5).forEach(t => {
                const li = document.createElement('li');
                li.innerText = `${t.name}: ${t.score}`;
                list.appendChild(li);
            });
        });

        socket.on('reset_buzzer', () => {
             document.getElementById('buzzer-status').classList.add('hidden');
        });
    </script>
</body>
</html>
