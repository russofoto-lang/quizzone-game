<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-6xl mx-auto grid grid-cols-3 gap-6">
    
    <div class="col-span-2 bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Gestione Domande</h2>
      
      <div class="mb-4">
        <label class="block mb-2">Domanda:</label>
        <input type="text" id="input-domanda" class="w-full border p-2 rounded" placeholder="Scrivi domanda...">
      </div>
      
      <div class="grid grid-cols-2 gap-2 mb-4">
          <input type="text" id="risp-1" class="border p-2" placeholder="Risposta 1">
          <input type="text" id="risp-2" class="border p-2" placeholder="Risposta 2">
          <input type="text" id="risp-3" class="border p-2" placeholder="Risposta 3">
          <input type="text" id="risp-4" class="border p-2" placeholder="Risposta 4">
      </div>

      <div class="mb-4">
          <label>Risposta Corretta (Testo o numero):</label>
          <input type="text" id="risp-corretta" class="border p-2 w-full">
      </div>

      <div class="flex gap-2">
          <button onclick="inviaDomanda('classico')" class="bg-blue-500 text-white px-4 py-2 rounded">Invia (Quiz)</button>
          <button onclick="inviaDomanda('buzzer')" class="bg-red-500 text-white px-4 py-2 rounded">Invia (Buzzer)</button>
          <button onclick="rivelaRisposta()" class="bg-green-500 text-white px-4 py-2 rounded">Rivela Risposta</button>
      </div>

      <div id="feed-risposte" class="mt-6 p-4 bg-gray-50 h-64 overflow-y-auto border">
          <h3 class="font-bold text-gray-500">Log Risposte in Tempo Reale:</h3>
          <ul id="log-list"></ul>
      </div>
    </div>

    <div class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Squadre (<span id="team-count">0</span>)</h2>
      <table class="w-full text-left">
          <thead>
              <tr class="border-b"><th class="pb-2">Nome</th><th class="pb-2">Punti</th><th>Azioni</th></tr>
          </thead>
          <tbody id="teams-table">
              </tbody>
      </table>
    </div>

  </div>

  <script>
    const socket = io();

    socket.on('connect', () => {
        socket.emit('admin_connect');
    });

    // Aggiornamento Lista Squadre
    socket.on('update_teams', (teamsArray) => {
        const tbody = document.getElementById('teams-table');
        tbody.innerHTML = '';
        document.getElementById('team-count').innerText = teamsArray.length;

        teamsArray.forEach(team => {
            const tr = document.createElement('tr');
            tr.className = "border-b";
            tr.innerHTML = `
                <td class="py-2 font-bold">${team.name}</td>
                <td class="py-2 text-blue-600">${team.score}</td>
                <td>
                    <button onclick="daiPunti('${team.id}', 100)" class="text-green-500 text-xs border p-1 rounded">+100</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    });

    // Log Risposte
    socket.on('risposta_ricevuta', (data) => {
        const ul = document.getElementById('log-list');
        const li = document.createElement('li');
        li.innerHTML = `<b>${data.teamName}</b>: ${data.risposta} 
                        <button onclick="daiPunti('${data.teamId}', 50)" class="ml-2 text-xs bg-green-100 text-green-700 px-1 rounded">Ok (+50)</button>`;
        ul.prepend(li);
    });

    socket.on('admin_buzzer_active', (data) => {
        alert("BUZZER PREMUTO DA: " + data.teamName);
    });

    // Funzioni Admin
    function inviaDomanda(modalita) {
        const domanda = {
            domanda: document.getElementById('input-domanda').value,
            risposte: [
                document.getElementById('risp-1').value,
                document.getElementById('risp-2').value,
                document.getElementById('risp-3').value,
                document.getElementById('risp-4').value
            ].filter(r => r !== ""), // Rimuove vuote
            corretta: document.getElementById('risp-corretta').value,
            modalita: modalita
        };
        socket.emit('invia_domanda', domanda);
    }

    function rivelaRisposta() {
        socket.emit('rivela_risposta');
    }

    function daiPunti(id, pts) {
        socket.emit('assegna_punti', { teamId: id, punti: pts });
    }
  </script>
</body>
</html>
