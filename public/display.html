<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display - Siponto Forever Young</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        .screen-transition {
            transition: opacity 0.5s ease-in-out;
        }
        .custom-message {
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255,255,255,0.1); }
            50% { box-shadow: 0 0 40px rgba(255,255,255,0.3); }
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        .animate-pulse-glow {
            animation: pulse-glow 2s infinite;
        }
    </style>
</head>
<body class="h-screen w-screen flex items-center justify-center p-4 overflow-hidden">
    
    <div id="display-container" class="w-full h-full relative">
        
        <!-- SCHERMATA DEFAULT/LOGO -->
        <div id="default-screen" class="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900 to-purple-900 animate-fade-in">
            <div class="text-8xl mb-8">üéÆ</div>
            <h1 class="text-6xl font-black uppercase tracking-tighter mb-2 text-center">SIPONTO</h1>
            <h2 class="text-4xl font-bold text-yellow-300 mb-12 text-center">FOREVER YOUNG</h2>
            <div class="text-2xl opacity-70 mt-8">In attesa del gioco...</div>
            <div class="mt-4 text-sm text-gray-400">Display attivo e connesso</div>
        </div>
        
        <!-- SCHERMATA CUSTOM/MESSAGGIO PERSONALIZZATO -->
        <div id="custom-screen" class="hidden w-full h-full flex items-center justify-center bg-gradient-to-br from-indigo-900 to-pink-900 animate-fade-in">
            <div class="max-w-6xl w-full p-8 text-center animate-pulse-glow rounded-3xl border border-white/20 bg-black/30 backdrop-blur-sm">
                <div class="text-6xl mb-6 opacity-70">üì¢</div>
                <div id="custom-message" class="text-5xl md:text-6xl font-bold leading-relaxed custom-message mb-8"></div>
                <div class="text-2xl opacity-60 mt-12">Messaggio dalla regia</div>
            </div>
        </div>
        
        <!-- SCHERMATA GIOCO (per domande) -->
        <div id="game-screen" class="hidden w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-green-900 to-teal-900 animate-fade-in">
            <div class="max-w-5xl w-full p-8">
                <div id="game-question" class="text-4xl md:text-5xl font-bold text-center mb-12 leading-tight"></div>
                <div id="game-options" class="grid grid-cols-2 gap-6 mt-8"></div>
            </div>
        </div>
        
        <!-- SCHERMATA CLASSIFICA -->
        <div id="classifica-screen" class="hidden w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-yellow-900 to-orange-900 animate-fade-in">
            <div class="max-w-6xl w-full p-8">
                <h1 class="text-5xl font-black text-center mb-12">üèÜ CLASSIFICA üèÜ</h1>
                <div id="classifica-list" class="space-y-4"></div>
            </div>
        </div>
        
        <!-- SCHERMATA VINCITORE -->
        <div id="winner-screen" class="hidden w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-green-900 to-yellow-900 animate-fade-in">
            <div class="max-w-6xl w-full p-8 text-center">
                <div class="text-8xl mb-8">üéâ</div>
                <h1 class="text-6xl font-black uppercase mb-4">VINCITORE!</h1>
                <div id="winner-name" class="text-5xl font-bold text-yellow-300 mb-2"></div>
                <div id="winner-score" class="text-4xl font-bold mb-12">Punteggio: <span class="text-white"></span></div>
                <div class="text-3xl opacity-70">Complimenti!</div>
            </div>
        </div>
        
        <!-- SCHERMATA PAUSA -->
        <div id="pausa-screen" class="hidden w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-orange-900 to-red-900 animate-fade-in">
            <div class="max-w-4xl w-full p-8 text-center">
                <div class="text-8xl mb-8">‚òï</div>
                <h1 class="text-6xl font-black uppercase mb-4">PAUSA</h1>
                <div class="text-4xl mb-12">Torniamo tra pochissimo!</div>
                <div class="text-2xl opacity-70">Preparatevi per il prossimo round</div>
            </div>
        </div>
        
        <!-- INFO CONNESSIONE -->
        <div class="absolute bottom-4 right-4 text-xs text-gray-400">
            <span id="connection-status" class="text-green-500">‚óè Connesso</span>
            <span id="current-view" class="ml-4">View: default</span>
        </div>
    </div>

    <script>
        const socket = io();
        let currentView = 'default';
        
        // Aggiorna stato connessione
        socket.on('connect', () => {
            document.getElementById('connection-status').textContent = '‚óè Connesso';
            document.getElementById('connection-status').className = 'text-green-500';
        });
        
        socket.on('disconnect', () => {
            document.getElementById('connection-status').textContent = '‚óã Disconnesso';
            document.getElementById('connection-status').className = 'text-red-500';
        });
        
        // Gestione cambio vista principale
        socket.on('cambia_vista', (data) => {
            console.log('Cambio vista:', data.view, data);
            currentView = data.view;
            document.getElementById('current-view').textContent = `View: ${data.view}`;
            
            // Nascondi tutte le schermate
            document.querySelectorAll('#display-container > div:not(.absolute)').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Mostra la schermata corretta
            switch(data.view) {
                case 'custom':
                    document.getElementById('custom-screen').classList.remove('hidden');
                    if(data.data && data.data.text) {
                        document.getElementById('custom-message').textContent = data.data.text;
                    } else {
                        document.getElementById('custom-message').textContent = "Messaggio dalla regia";
                    }
                    break;
                    
                case 'logo':
                case 'logo_forever':
                    document.getElementById('default-screen').classList.remove('hidden');
                    break;
                    
                case 'game':
                    document.getElementById('game-screen').classList.remove('hidden');
                    if(data.data && data.data.domanda) {
                        document.getElementById('game-question').textContent = data.data.domanda;
                    }
                    break;
                    
                case 'classifica_gen':
                case 'classifica_round':
                    document.getElementById('classifica-screen').classList.remove('hidden');
                    if(data.data && Array.isArray(data.data)) {
                        const listDiv = document.getElementById('classifica-list');
                        listDiv.innerHTML = '';
                        
                        data.data.slice(0, 10).forEach((team, index) => {
                            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                            const teamDiv = document.createElement('div');
                            teamDiv.className = 'flex justify-between items-center bg-white/10 p-4 rounded-xl';
                            teamDiv.innerHTML = `
                                <div class="flex items-center">
                                    <span class="text-3xl mr-4">${medal}</span>
                                    <span class="text-3xl font-bold">${team.name || team.teamName || 'Squadra'}</span>
                                </div>
                                <div class="text-3xl font-black text-yellow-300">${team.score || team.punti || 0}</div>
                            `;
                            listDiv.appendChild(teamDiv);
                        });
                    }
                    break;
                    
                case 'winner':
                    document.getElementById('winner-screen').classList.remove('hidden');
                    if(data.data) {
                        document.getElementById('winner-name').textContent = data.data.winnerName || 'Vincitore';
                        document.querySelector('#winner-score span').textContent = data.data.winnerScore || 0;
                    }
                    break;
                    
                case 'pausa':
                    document.getElementById('pausa-screen').classList.remove('hidden');
                    break;
                    
                case 'benvenuto':
                    document.getElementById('custom-screen').classList.remove('hidden');
                    document.getElementById('custom-message').textContent = "Benvenuti a Siponto Forever Young!";
                    break;
                    
                case 'regole':
                    document.getElementById('custom-screen').classList.remove('hidden');
                    document.getElementById('custom-message').textContent = "Regole del gioco: Rispondi alle domande e accumula punti!";
                    break;
                    
                case 'punteggi':
                    document.getElementById('custom-screen').classList.remove('hidden');
                    document.getElementById('custom-message').textContent = "Sistema punteggi: +100 risposta corretta + bonus velocit√†";
                    break;
                    
                case 'prossima':
                    document.getElementById('custom-screen').classList.remove('hidden');
                    document.getElementById('custom-message').textContent = "Prossima domanda tra poco...";
                    break;
                    
                default:
                    document.getElementById('default-screen').classList.remove('hidden');
            }
        });
        
        // Gestione domande dirette
        socket.on('nuova_domanda', (data) => {
            console.log('Nuova domanda:', data);
            currentView = 'game';
            document.getElementById('current-view').textContent = 'View: game';
            
            // Nascondi tutte le schermate
            document.querySelectorAll('#display-container > div:not(.absolute)').forEach(el => {
                el.classList.add('hidden');
            });
            
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-question').textContent = data.domanda || 'Domanda';
            
            const optionsDiv = document.getElementById('game-options');
            optionsDiv.innerHTML = '';
            
            if(data.risposte && Array.isArray(data.risposte)) {
                data.risposte.forEach((risposta, index) => {
                    const button = document.createElement('div');
                    button.className = 'bg-white/20 p-6 rounded-2xl text-center text-3xl font-bold cursor-default hover:bg-white/30 transition-all';
                    button.textContent = risposta;
                    optionsDiv.appendChild(button);
                });
            }
        });
        
        // Gestione soluzioni
        socket.on('mostra_soluzione', (data) => {
            console.log('Mostra soluzione:', data);
            
            document.getElementById('custom-screen').classList.remove('hidden');
            document.getElementById('custom-message').textContent = `Risposta corretta: ${data.soluzione || '---'}`;
        });
        
        // Forza ricarica
        socket.on('force_reload', () => {
            window.location.reload();
        });
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Display pronto');
            document.getElementById('default-screen').classList.remove('hidden');
        });
    </script>
</body>
</html>
